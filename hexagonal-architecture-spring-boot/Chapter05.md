# 5장. 웹 어댑터 구현하기

헥사고날 아키텍처에서 외부 세계와의 커뮤니케이션은 어댑터를 통해 이뤄진다. <br>
웹 인터페이스를 제공하는 어댑터의 구현 방법을 알아보자.

## 의존성 역전

웹 어댑터는 '주도하는 (Driving)' 인커밍 어댑터 이다. <br>
이때 제어흐름은 웹 어댑터에 있는 컨트롤러에서 애플리케이션 계층에 있는 서비스로 흐른다.

그럼 왜 어댑터와 유스케이스 사이에 또 다른 간접 계층(port) 을 넣어야 할까? <br>
`애플리케이션 코어가 외부 세계와 통신할 수 있는 곳에 대한 명세가 포트이기 때문이다.`
포트를 적절한 곳에 위치시키면 외부와 어떤 통신이 일어나고 있는지 정확히 알 수 있다.

인커밍 어댑터가 꼭 인커밍 포트를 호출할 필요는 없다. <br>
웹소켓 컨트롤러 같은 경우 인커밍 어댑터인 동시에 아웃고잉 어댑터도 될 수 있다. 

## 웹 어댑터의 책임

웹 어댑터는 실제로 어떤 일을 할까? 보통 다음과 같은 일을 한다.

1. HTTP 요청을 자바 객체로 매핑
2. 권한검사
3. 입력 유효성 검증
4. 입력을 유스케이스의 입력 모델로 매핑
5. 유스케이스 호출
6. 유스케이스의 출력을 HTTP 로 매핑
7. HTTP 응답을 반환

3번 입력 유효성 검증은 웹 어댑터의 입력 모델에 대한 검증을 말하는 것이다. <br>
웹 어댑터의 입력 모델과 유스케이스의 입력 모델은 구조나 의미가 완전히 다를 수 있어서, 웹 어댑터의 입력 유효성 검증도 필요하다. <br>

유스케이스 입력 모델에서 했던 유효성 검증을 똑같이 하기보다는 `웹 어댑터의 입력 모델을 유스케이스의 입력 모델로 변활할 수 있다` 는 것을 검증하면 된다. <br>
유스케이스의 입력 모델에서 문제가 생기면 예외가 발생할 것이고, 웹 어댑터에서는 에러를 호출자에게 보여줄 메시지로 변환하면 된다.

웹 어댑터의 책임이 너무 많은건 아닐까? 하지만 HTTP 와 관련된 것들은 애플리케이션으로 침투하면 안된다. <br> 
`바깥 계층에서 HTTP 를 다루고 있다는 것을 애플리케이션 코어가 알게되면 HTTP를 사용하지 않는 어댑터 요청에 대해 동일한 로직을 수행할 수 없다.`

유스케이스를 먼저 구현하면 애플리케이션 계층과 웹 어댑터 계층간 경계를 명확하게 하는데 도움이 된다.

## 컨트롤러 나누기

Spring MVC 를 사용하면 하나의 컨트롤러 클래스의 여러 요청을 추가할 수 있다. <br>
하나의 클래스에 모든 요청이 들어가 있는 것 보다, 가능한 컨트롤러를 나누어 다른 컨트롤러와 적게 공유하는 웹 어댑터를 구현해야 한다.

AccountController 에 계좌에 관련된 여러개의 요청이 들어가 있다면 다음 단점들이 존재한다.

* 코드가 길어져서 컨트롤러를 파악하는 것이 어렵다.
* 마찬가지로 컨트롤러의 테스트 코드 파악하는 것도 어렵다.
* 단일 컨트롤러는 하나의 큰 모델 클래스를 공유할 가능성이 높아진다.

그래서 가능한 유스케이스 별로 컨트롤러를 만드는 것을 추천한다. <br>

## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

웹 어댑터와 애플리케이션을 명확하게 분리하면 애플리케이션 계층은 HTTP 에 의존하지 않게 되고, <br>
필요할 경우 웹 어댑터를 다른 어댑터로 교체하기 쉬워진다.

웹 컨트롤러를 잘게 나누게 되면, 컨트롤러들을 파악하기 쉽고, 테스트 하기 쉬워진다.
처음 만들때는 공수가 좀 더 들겠지만 유지보수 하는 동안에는 분명히 빛을 발할 것이다.




