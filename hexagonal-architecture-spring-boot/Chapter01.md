# 1장. 계층형 아키텍처의 문제는 무엇일까?
# 계층형 아키텍처
계층형 아키텍처는 잘 이해하고 구성하면 웹계층이나 영속성 계층에 독립적으로 도메인 로직을 작성할 수 있다.
잘 만들어진 계층형 아키텍처는 선택의 폭을 넓히고, 변화하는 요구사항과 외부 요인에 빠르게 적응할 수 있게 해준다.

# 계층형 아키텍처의 문제점
### 모든 계층이 영속성 계층(상태) 에 의존한다.
우리는 상태가 아니라 행동 중심으로 모델링 해야한다. 행동이 비즈니스를 이끌어가기 때문이다.
**우리는 도메인 로직 (비즈니스 로직)을  먼저 만들어야 한다.**

ORM 프레임워크(영속성 코드) 를 사용하면 비즈니스 규칙을 영속성 관점과 섞고 싶은 유혹을 쉽게 받는다.
**그러나 영속성 코드와 도메인 코드가 섞여버리면 줄 둥 하나만 바꾸는 것이 어려워진다.**

### 지름길을 택하기 쉬워진다.
저자가 말하는 계층형 아키텍처의 유일한 규칙 
-> 특정 계층에서는 같은 계층에 잇는 컴포넌트나 아래에 있는 계층에만 접근 가능하다.

만약 상위 계층에 있는 컴포넌트에 접근해야 하면? 
-> 그 컴포넌트를 아래로 계층으로 내려버린다.
-> 한 두번이 아닌 계속 그러면
-> 제일 아래 계층 (영속성 계층) 이 비대 해진다.

### 테스트하기 어려워진다.
간단한 유스케이스라서 웹 계층에서 영속성 엔티티의 필드 하나만 조작하고 싶다.
-> 유스케이스가 확장되어 웹 계층에 점점 많은 도메인 로직이 들어간다.
-> 애플리케이션 전반에 핵심 로직이 흩어지게 된다.

웹 계층 테스트에서 영속성 계층을 mocking 해야 한다.
-> 단위 테스트의 복잡도가 올라간다.
-> 시간이 점점 흐르면 테스트 코드를 작성하는 것 보다 종속성을 이해하는데 더 큰 시간을 쓴다.

### 유스케이스를 숨긴다.
계층형 아키텍처는 도메인 로직이 여러 계층에 걸쳐 흩어지기 쉽다.
-> 이럴 경우 새로운 기능을 추가할 적당한 위치를 찾기 어려워진다.

UserService 에서 사용자 등록 유스케이스를 찾는 대신, RegisterUserService 를 바로 열어서 작업하는게 훨씬 수월하다.

### 동시 작업이 어려워진다.
계층형 아키텍쳐에서 한 명이 웹 계층, 한 명이 도메인 계층 나머지 한 명이 영속성 계층을 개발할 수 있을까?
-> 없다. 계층형 아키텍처에서는 모든 것이 영속성 계층 위에 만들어지기 때문이다.

코드에 넓은 서비스가 있다면 서로 다른 기능을 동시에 작업하기가 더욱 어렵다.
서로 다른 유스케이스에 대해서 작업 하더라도 같은 서비스를 동시에 편집하는 상황이 발생하기 때문이다.

## 정리
계층형  아키텍처의 함정을 머릿속에 염두해 두고, 지름길을 택하지 않는다면, 계층형 아키텍처에서도 유지보수하기 쉬운 코드를 작성할 수 있다.


#책정리/만들면서_배우는_클린아키텍쳐
